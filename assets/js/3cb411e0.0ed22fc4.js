"use strict";(self.webpackChunkpabpereza=self.webpackChunkpabpereza||[]).push([[6584],{94952:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var o=s(17624),a=s(4552);const r={},i=void 0,c={id:"notas/Kubernetes/services",title:"services",description:"Los servicios en kubernetes son una forma de agrupar pods mediande sus etiquetas o labels y disponer a los usuarios",source:"@site/docs/notas/Kubernetes/services.md",sourceDirName:"notas/Kubernetes",slug:"/notas/Kubernetes/services",permalink:"/docs/notas/Kubernetes/services",draft:!1,unlisted:!1,editUrl:"https://github.com/pabpereza/pabpereza/tree/main/docs/notas/Kubernetes/services.md",tags:[],version:"current",frontMatter:{},sidebar:"notas",previous:{title:"seguridad",permalink:"/docs/notas/Kubernetes/seguridad"},next:{title:"usuarios_roles",permalink:"/docs/notas/Kubernetes/usuarios_roles"}},l={},d=[{value:"Endpoints",id:"endpoints",level:2},{value:"Tipos de servicios",id:"tipos-de-servicios",level:2},{value:"ClusterIP",id:"clusterip",level:3},{value:"NodePort",id:"nodeport",level:3},{value:"LoadBalancer",id:"loadbalancer",level:3},{value:"Accediendo a una aplicaci\xf3n con un servicio",id:"accediendo-a-una-aplicaci\xf3n-con-un-servicio",level:2},{value:"Borrar endpoints",id:"borrar-endpoints",level:2}];function t(e){const n={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,a.M)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Los servicios en kubernetes son una forma de agrupar pods mediande sus etiquetas o labels y disponer a los usuarios\nel acceso a los recursos que est\xe1n asociados a ellos."}),"\n",(0,o.jsx)(n.p,{children:"Los pods en kubernetes son ef\xedmeros y cambiaran frecuentemente, con ellos, tambien sus IPs por lo que los servicios entregan una IP\n\xfanica (tambi\xe9n tiene DNS), adem\xe1s de balancear las peticiones entre los pods que est\xe1n asociados a un servicio."}),"\n",(0,o.jsx)(n.p,{children:"Partiendo del [[deployments]] anterior podemos crear un servicio de la misma forma:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\n  labels:\n    app: nginx\nspec:\n  selector:\n\tapp: nginx\n  ports:\n  - port: 8080\n\ttargetPort: 80\n"})}),"\n",(0,o.jsx)(n.p,{children:"Es importante destacar que el selector del servicio tiene que igual al label del deployment para que este funcione."}),"\n",(0,o.jsxs)(n.p,{children:["Haciendo foco en la declaraci\xf3n del servicio tambien hay que destacar que, la instrucci\xf3n ",(0,o.jsx)(n.code,{children:"port"})," indica el puerto al que va a escuchar el servicio, y ",(0,o.jsx)(n.code,{children:"targetPort"})," indica el puerto del pod al que el servicio va a enviar las peticiones."]}),"\n",(0,o.jsx)(n.p,{children:"Podemos consultar el estado del servicio con el comando:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get service nginx-service\nkubectl get svc nginx-service # Podemos abreviar el comando anterior\n"})}),"\n",(0,o.jsx)(n.p,{children:"Podemos describir el servicio con el comando:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl describe svc nginx-service\n"})}),"\n",(0,o.jsx)(n.p,{children:"Esto nos devolver\xeda una salida similar a la siguiente:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"Name:              nginx-service\nNamespace:         default\nLabels:            app=front\nAnnotations:       <none>\nSelector:          app=front\nType:              ClusterIP\nIP Family Policy:  SingleStack\nIP Families:       IPv4\nIP:                10.98.234.17\nIPs:               10.98.234.17\nPort:              <unset>  8080/TCP\nTargetPort:        80/TCP\nEndpoints:         172.17.0.3:80,172.17.0.4:80,172.17.0.5:80\nSession Affinity:  None\nEvents:            <none>\n"})}),"\n",(0,o.jsx)(n.h2,{id:"endpoints",children:"Endpoints"}),"\n",(0,o.jsxs)(n.p,{children:["Uno de los datos m\xe1s interesantes de la salida anterior en el campo ",(0,o.jsx)(n.code,{children:"Endpoints"}),". Este recoge las IPs de los pods con los que esta conectando el servicio para automatizar que el usuario pueda acceder a ellos."]}),"\n",(0,o.jsx)(n.p,{children:"Adem\xe1s, si alg\xfan pod nuevo aparece o desaparece el servicio sabr\xeda y actualizar\xeda los endpoints."}),"\n",(0,o.jsx)(n.p,{children:"Tambi\xe9n podr\xedamos listar todos los endpoints del namespace con el commando:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get endpoints\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Podr\xedamos abreviar el comando anterior (con ",(0,o.jsx)(n.code,{children:"ep"}),") y a la vez consultar espec\xedficamente el endpoint de un servicio:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get ep nginx-service\n"})}),"\n",(0,o.jsx)(n.h2,{id:"tipos-de-servicios",children:"Tipos de servicios"}),"\n",(0,o.jsx)(n.p,{children:"La jerarqu\xeda de los servicios es la siguiente:"}),"\n",(0,o.jsx)(n.p,{children:"![[services.drawio.svg]]"}),"\n",(0,o.jsx)(n.h3,{id:"clusterip",children:"ClusterIP"}),"\n",(0,o.jsx)(n.p,{children:"Es el servicio por defecto en kubernetes, en caso de que no especifiquemos ning\xfan otro. Su funci\xf3n es crear una conexi\xf3n a los pods sin exponerlos a la red externa."}),"\n",(0,o.jsxs)(n.p,{children:["Si listamos los servicios podemos ver que, el servicio nginx-service que lanzamos antes, tiene la IP del cluster asignada pero la IP externa se queda con el valor ",(0,o.jsx)(n.code,{children:"none"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get service                                                       \n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)     AGE\nkubernetes      ClusterIP   10.96.0.1      <none>        443/TCP     19d\nnginx-service   ClusterIP   10.98.234.17   <none>        38080/TCP   10h\n"})}),"\n",(0,o.jsx)(n.h3,{id:"nodeport",children:"NodePort"}),"\n",(0,o.jsx)(n.p,{children:"Es un servicio que conecta un puerto de nodo (red externa) a un puerto de uno o m\xe1s pods."}),"\n",(0,o.jsx)(n.p,{children:"Si no le especificamos un puerto, el servicio utiliza uno en el rango del 30000 al 32767."}),"\n",(0,o.jsxs)(n.p,{children:["Para crear un servicio de tipo NodePort solo tenemos que indicarlo en el ",(0,o.jsx)(n.code,{children:"type"})," dentro del ",(0,o.jsx)(n.code,{children:"spec"})," del servicio:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: 1                                                                      \nkind: Service\nmetadata:\n  name: nginx-service\n  labels:\n    app: front\nspec:\n  type: NodePort # Definici\xf3n del tipo de servicio\n  selector:\n    app: front\n  ports:\n  - port: 8080\n    targetPort: 80\n"})}),"\n",(0,o.jsx)(n.p,{children:"Este tipo tambi\xe9n crea una IP del cluster, pero en este caso tambi\xe9n abre un puerto a la red externa."}),"\n",(0,o.jsx)(n.h3,{id:"loadbalancer",children:"LoadBalancer"}),"\n",(0,o.jsx)(n.p,{children:"Sirve para exponer servicios a trav\xe9s de la red externa. Podr\xeda ser utilizado para exponer servicios web, servicios de bases de datos, etc."}),"\n",(0,o.jsx)(n.p,{children:"Se podr\xeda definir un servicio de tipo LoadBalancer con el siguiente comando para un deployment espec\xedfico:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl expose deployment nginx-deployment --type=LoadBalancer\n"})}),"\n",(0,o.jsx)(n.h2,{id:"accediendo-a-una-aplicaci\xf3n-con-un-servicio",children:"Accediendo a una aplicaci\xf3n con un servicio"}),"\n",(0,o.jsxs)(n.p,{children:["Podr\xedamos crear un servicio v\xeda ",(0,o.jsx)(n.code,{children:"kubectl"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl expose deployment/nginx --port=80 --type=NodePort\n"})}),"\n",(0,o.jsx)(n.p,{children:"Podemos consultar los servicios con los siguientes comandos:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get svc # Listar todos los servicios\n\nkubectl get svc nginx -o yaml # Listar un servicio concreto\n"})}),"\n",(0,o.jsx)(n.h2,{id:"borrar-endpoints",children:"Borrar endpoints"}),"\n",(0,o.jsx)(n.p,{children:"Podemos borrar un endpoint con el comando:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl delete endpoint nginx\nkubectl delete ep nginx # Podemos abreviar el comando anterior\n"})})]})}function p(e={}){const{wrapper:n}={...(0,a.M)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}},4552:(e,n,s)=>{s.d(n,{I:()=>c,M:()=>i});var o=s(11504);const a={},r=o.createContext(a);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);