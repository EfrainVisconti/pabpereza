"use strict";(self.webpackChunkpabpereza=self.webpackChunkpabpereza||[]).push([[6820],{69532:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>m,frontMatter:()=>s,metadata:()=>t,toc:()=>l});var o=a(17624),r=a(4552);const s={},c=void 0,t={id:"notas/Kubernetes/secrets_configmaps",title:"secrets_configmaps",description:"Kubernetes nos permite compartir informaci\xf3n y configuraciones entre el cluster y los distintos recursos de kubernetes.",source:"@site/docs/notas/Kubernetes/secrets_configmaps.md",sourceDirName:"notas/Kubernetes",slug:"/notas/Kubernetes/secrets_configmaps",permalink:"/docs/notas/Kubernetes/secrets_configmaps",draft:!1,unlisted:!1,editUrl:"https://github.com/pabpereza/pabpereza/tree/main/docs/notas/Kubernetes/secrets_configmaps.md",tags:[],version:"current",frontMatter:{},sidebar:"notas",previous:{title:"scheduling",permalink:"/docs/notas/Kubernetes/scheduling"},next:{title:"seguridad",permalink:"/docs/notas/Kubernetes/seguridad"}},i={},l=[{value:"Secrets",id:"secrets",level:2},{value:"Usando secretos en un pod",id:"usando-secretos-en-un-pod",level:3},{value:"Crea un configmap",id:"crea-un-configmap",level:2},{value:"Crear un configmap con comandos",id:"crear-un-configmap-con-comandos",level:3},{value:"Crear un configmap con yaml",id:"crear-un-configmap-con-yaml",level:3},{value:"Usar configmap en un pod",id:"usar-configmap-en-un-pod",level:2},{value:"Utilizar en el entorno de un pod",id:"utilizar-en-el-entorno-de-un-pod",level:3},{value:"Montar como volumen en un pod",id:"montar-como-volumen-en-un-pod",level:3},{value:"Borrar un configmap",id:"borrar-un-configmap",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.M)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Kubernetes nos permite compartir informaci\xf3n y configuraciones entre el cluster y los distintos recursos de kubernetes."}),"\n",(0,o.jsx)(n.h2,{id:"secrets",children:"Secrets"}),"\n",(0,o.jsx)(n.p,{children:"Los secretos en kubernetes son una forma de almacenar informaci\xf3n sensible. Estos se almacenan en una base de datos de forma privada y pueden consumir por otros recursos de kubernetes."}),"\n",(0,o.jsx)(n.p,{children:"Podemos obtener, crear o eliminar secretos en kubernetes con los siguientes comandos."}),"\n",(0,o.jsx)(n.p,{children:"Listar secretos:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get secrets\n"})}),"\n",(0,o.jsx)(n.p,{children:"Crear secretos:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Create a new secret named my-secret with keys for each file in folder bar\nkubectl create secret generic my-secret --from-file=path/to/bar\n\n# Create a new secret named my-secret with specified keys instead of names on disk\nkubectl create secret generic my-secret --from-file=ssh-privatekey=path/to/id_rsa --from-file=ssh-publickey=path/to/id_rsa.pub\n\n# Create a new secret named my-secret with key1=supersecret and key2=topsecret\nkubectl create secret generic my-secret --from-literal=key1=supersecret --from-literal=key2=topsecret\n\n# Create a new secret named my-secret using a combination of a file and a literal\nkubectl create secret generic my-secret --from-file=ssh-privatekey=path/to/id_rsa --from-literal=passphrase=topsecret\n\n# Create a new secret named my-secret from an env file\nkubectl create secret generic my-secret --from-env-file=path/to/bar.env\n"})}),"\n",(0,o.jsx)(n.p,{children:"Borrar un secreto:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl delete secret <nombre>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"usando-secretos-en-un-pod",children:"Usando secretos en un pod"}),"\n",(0,o.jsx)(n.p,{children:"Un secreto se puede usar en un pod. Podr\xedamos pasarlo como una variable de entorno como en el siguiente ejemplo:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"...\nspec:\n    containers:\n    - image: mysql:5.5\n      name: dbpod\n      env:\n      - name: MYSQL_ROOT_PASSWORD\n        valueFrom:\n            secretKeyRef:\n              name: mysql\n              key: password \n"})}),"\n",(0,o.jsx)(n.p,{children:"Tambi\xe9n podr\xedamos montarlo como un volumen en su manifest. Este Requerir\xeda el path donde estamos montando un fichero con el contenido del secreto.\nMounting Secrets as Volumes\nYou can also mount secrets as files using a volume definition in a pod manifest. The mount path will contain a file whose name will be the key of the secret created with the kubectl create secret step earlier."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'...\nspec:\n    containers:\n    - image: busybox\n      command:\n        - sleep\n        - "3600"\n      volumeMounts:\n      - mountPath: /mysqlsecret\n        name: mysqlsecret\n      name: busy\n    volumes:\n    - name: mysqlsecret\n        secret:\n            secretName: mmysql\n'})}),"\n",(0,o.jsx)(n.h2,{id:"crea-un-configmap",children:"Crea un configmap"}),"\n",(0,o.jsx)(n.p,{children:"Dado el caracter ef\xedmero de un pod en kubernetes necesitamos alg\xfan m\xe9todo para compartir ficheros o informaci\xf3n entre los contenedores dentro de un pod."}),"\n",(0,o.jsx)(n.h3,{id:"crear-un-configmap-con-comandos",children:"Crear un configmap con comandos"}),"\n",(0,o.jsx)(n.p,{children:"Para crear un config map usamos el siguiente comando:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:" kubectl create configmap <nombre> \\\n --from-literal=text=<texto> \\\n --from-file=<fichero> \\\n --from-file=<directorio>\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Este nos permite importar informaci\xf3n ya sea text en plano que introduzcamos en el comando (",(0,o.jsx)(n.code,{children:"--from-literal=text="}),"), el contenido de un fichero (",(0,o.jsx)(n.code,{children:"--from-file="}),") o el contenido de un directorio completo (",(0,o.jsx)(n.code,{children:"--from-file="}),")."]}),"\n",(0,o.jsx)(n.p,{children:"Podemos consultar el contenido de un configmap con el siguiente comando:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get configmap <nombre>\n"})}),"\n",(0,o.jsx)(n.p,{children:"Aunque este solo nos mostrar\xe1 el total de datos y su edad. Podemos obtener el contenido completo especificando la salida en formato yaml:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get configmap <nombre> -o yaml\n"})}),"\n",(0,o.jsx)(n.h3,{id:"crear-un-configmap-con-yaml",children:"Crear un configmap con yaml"}),"\n",(0,o.jsx)(n.p,{children:"Podr\xedamos declararlo como un yaml para facilitar el almacenamiento de la configuraci\xf3n como c\xf3digo."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: cars\n  namespace: default\ndata:\n  car.make: Opel \n  car.model: Astra \n  car.trim: OPC\n"})}),"\n",(0,o.jsx)(n.p,{children:"Para guardar el configmap en el cluster podemos usar el comando:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl create -f <configmap>.yaml\n"})}),"\n",(0,o.jsx)(n.h2,{id:"usar-configmap-en-un-pod",children:"Usar configmap en un pod"}),"\n",(0,o.jsx)(n.h3,{id:"utilizar-en-el-entorno-de-un-pod",children:"Utilizar en el entorno de un pod"}),"\n",(0,o.jsx)(n.p,{children:"Podemos configurar el contenido de un configmap en un pod como variable de entorno as\xed:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: demo \nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    env:\n    - name: <nombre de la variable de entorno> \n      valueFrom:\n        configMapKeyRef:\n          name: <nombre_configmap> \n          key: <clave a usar> \n"})}),"\n",(0,o.jsx)(n.p,{children:"Esto nos permitir\xeda importar una \xfanica clave del configmap."}),"\n",(0,o.jsx)(n.p,{children:"Tambi\xe9n podr\xedamos importar todo el contenido del configmap as\xed:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: demo \nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    envFrom:\n    - configMapRef:\n      name: <nombre_configmap> \n"})}),"\n",(0,o.jsxs)(n.p,{children:["Cambiar\xedamos el ",(0,o.jsx)(n.code,{children:"configMapKeyRef"})," por ",(0,o.jsx)(n.code,{children:"configMapRef"})," y ",(0,o.jsx)(n.code,{children:"env"})," por ",(0,o.jsx)(n.code,{children:"envFrom"}),". Por \xfaltimo, borrar\xedamos ",(0,o.jsx)(n.code,{children:"key"})," y ",(0,o.jsx)(n.code,{children:"valueFrom"})," datos que ya no tendr\xedamos que especificar."]}),"\n",(0,o.jsx)(n.h3,{id:"montar-como-volumen-en-un-pod",children:"Montar como volumen en un pod"}),"\n",(0,o.jsx)(n.p,{children:"Podemos montar un configmap como un volumen en un pod. Esta ser\xeda una configuraci\xf3n de ejemplO:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: shell-demo\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    volumeMounts:\n    - name: car-vol\n      mountPath: /etc/cars\n  volumes:\n    - name: car-vol\n      configMap:\n        name: cars\n"})}),"\n",(0,o.jsx)(n.h2,{id:"borrar-un-configmap",children:"Borrar un configmap"}),"\n",(0,o.jsx)(n.p,{children:"Podemos elimitar este objeto de kubernetes con el comando:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl delete\n"})})]})}function m(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},4552:(e,n,a)=>{a.d(n,{I:()=>t,M:()=>c});var o=a(11504);const r={},s=o.createContext(r);function c(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);