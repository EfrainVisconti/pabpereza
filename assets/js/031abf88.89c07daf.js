"use strict";(self.webpackChunkpabpereza=self.webpackChunkpabpereza||[]).push([[2984],{72024:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>r});var a=l(17624),o=l(4552);const t={},i=void 0,s={id:"notas/Kubernetes/deployments",title:"deployments",description:"Los deployments son elementos de configuraci\xf3n que permiten la creaci\xf3n de una aplicaci\xf3n de una sola instancia.",source:"@site/docs/notas/Kubernetes/deployments.md",sourceDirName:"notas/Kubernetes",slug:"/notas/Kubernetes/deployments",permalink:"/docs/notas/Kubernetes/deployments",draft:!1,unlisted:!1,editUrl:"https://github.com/pabpereza/pabpereza/tree/main/docs/notas/Kubernetes/deployments.md",tags:[],version:"current",frontMatter:{},sidebar:"notas",previous:{title:"Inyecci\xf3n SQL",permalink:"/docs/notas/Inyecci\xf3n SQL"},next:{title:"helm",permalink:"/docs/notas/Kubernetes/helm"}},d={},r=[{value:"Definici\xf3n de un deployment",id:"definici\xf3n-de-un-deployment",level:2},{value:"Crear un deployment con comandos",id:"crear-un-deployment-con-comandos",level:2},{value:"Actualizar un deployment",id:"actualizar-un-deployment",level:2},{value:"Escalar un deployment",id:"escalar-un-deployment",level:2},{value:"Historial de un deployment",id:"historial-de-un-deployment",level:2},{value:"Modificar el l\xedmite del historial de un deployment",id:"modificar-el-l\xedmite-del-historial-de-un-deployment",level:3},{value:"Hacer un rollback a una versi\xf3n anterior",id:"hacer-un-rollback-a-una-versi\xf3n-anterior",level:3},{value:"Pausar y reanudar un deployment",id:"pausar-y-reanudar-un-deployment",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.M)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["Los ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/",children:"deployments"})," son elementos de configuraci\xf3n que permiten la creaci\xf3n de una aplicaci\xf3n de una sola instancia."]}),"\n",(0,a.jsx)(n.p,{children:"El deployment gestiona uno o varios objetos replicaset y estos a su vez gestionan uno o m\xe1s pods."}),"\n",(0,a.jsx)(n.h2,{id:"definici\xf3n-de-un-deployment",children:"Definici\xf3n de un deployment"}),"\n",(0,a.jsx)(n.p,{children:"Este es un ejemplo de su estructura b\xe1sica:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.9\n        ports:\n        - containerPort: 80\n"})}),"\n",(0,a.jsx)(n.p,{children:"Aplicar\xeda la configuraci\xf3n anterior con el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f deployment.yaml\n"})}),"\n",(0,a.jsx)(n.p,{children:"Este deployment gestionar\xeda los servicios de replicaset y los contenedores\nde nginx definidos."}),"\n",(0,a.jsx)(n.p,{children:"Podr\xedamos consultar el estado del deployment con el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl get deployment nginx-deployment\n"})}),"\n",(0,a.jsx)(n.p,{children:"El cual nos devolver\xeda una salida similar a la siguiente:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"NAME                            READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment                3       3            3           2m\n"})}),"\n",(0,a.jsx)(n.h2,{id:"crear-un-deployment-con-comandos",children:"Crear un deployment con comandos"}),"\n",(0,a.jsx)(n.p,{children:"Tambi\xe9n podemos crear un deployment con una sola instancia con el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl create deployment nginx --image=nginx\n"})}),"\n",(0,a.jsx)(n.h2,{id:"actualizar-un-deployment",children:"Actualizar un deployment"}),"\n",(0,a.jsx)(n.p,{children:"Supongamos que queremos actualizar el deployment para que gestione una nueva imagen, concretamente, las de nginx basadas en alpine. El yaml de configuraci\xf3n quedar\xeda as\xed:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:alpine\n        ports:\n        - containerPort: 80\n"})}),"\n",(0,a.jsx)(n.p,{children:"Aplicamos los cambios de nuevo con el comando 'kubectl apply -f deployment.yaml' y esta vez nos devuelve que se ha configurado, en vez de crearse:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f deployment.yaml\ndeployment.apps/deployment-test configured #Salida del comando\n"})}),"\n",(0,a.jsx)(n.p,{children:"Adem\xe1s, kubernetes gestiona las actualizaciones de los deployment para que sean progresivo entre un cambio de versi\xf3n y el servicio de que dan los pods no se interrumpa."}),"\n",(0,a.jsx)(n.p,{children:"Se puede consultar la actualizaci\xf3n del deployment en tiempo real con el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl rollout status deployment nginx-deployment\n"})}),"\n",(0,a.jsx)(n.p,{children:"Este comando nos devolver\xeda paso a paso la actualizaci\xf3n del deployment:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'Waiting for deployment "nginx-deployment" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment "nginx-deployment" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment "nginx-deployment" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment "nginx-deployment" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment "nginx-deployment" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment "nginx-deployment" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment "nginx-deployment" rollout to finish: 1 old replicas are pending termination...\nWaiting for deployment "nginx-deployment" rollout to finish: 1 old replicas are pending termination...\ndeployment "nginx-deployment" successfully rolled out\n'})}),"\n",(0,a.jsx)(n.p,{children:"Si el despliegue ya ha terminado no se mostrar\xe1 este proceso de actualizaci\xf3n. Aun as\xed, podremos consultarlo\nen el registro de eventos usando el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl describe deployment nginx-deployment\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"Events:\n  Type    Reason             Age    From                   Message\n  ----    ------             ----   ----                   -------\n  Normal  ScalingReplicaSet  4m27s  deployment-controller  Scaled up replica set nginx-deployment-59c46f7dff to 3\n  Normal  ScalingReplicaSet  4m8s   deployment-controller  Scaled up replica set nginx-deployment-5c4d5dcbf5 to 1\n  Normal  ScalingReplicaSet  4m4s   deployment-controller  Scaled down replica set nginx-deployment-59c46f7dff to 2\n  Normal  ScalingReplicaSet  4m4s   deployment-controller  Scaled up replica set nginx-deployment-5c4d5dcbf5 to 2\n  Normal  ScalingReplicaSet  4m2s   deployment-controller  Scaled down replica set nginx-deployment-59c46f7dff to 1\n  Normal  ScalingReplicaSet  4m2s   deployment-controller  Scaled up replica set nginx-deployment-5c4d5dcbf5 to 3\n  Normal  ScalingReplicaSet  4m     deployment-controller  Scaled down replica set nginx-deployment-59c46f7dff to 0\n"})}),"\n",(0,a.jsx)(n.h2,{id:"escalar-un-deployment",children:"Escalar un deployment"}),"\n",(0,a.jsx)(n.p,{children:"Podemos escalar el deployment con el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl scale deployment nginx-deployment --replicas=5\n"})}),"\n",(0,a.jsx)(n.h2,{id:"historial-de-un-deployment",children:"Historial de un deployment"}),"\n",(0,a.jsx)(n.p,{children:"Podemos consultar el historial de un deployment con el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl rollout history deployment nginx-deployment\n"})}),"\n",(0,a.jsx)(n.h3,{id:"modificar-el-l\xedmite-del-historial-de-un-deployment",children:"Modificar el l\xedmite del historial de un deployment"}),"\n",(0,a.jsx)(n.p,{children:"Por defecto, el historial de un deployment muestra las \xfaltimas 10 actualizaciones a menos que modifiquemos\nel valor 'revisionHistoryLimit' en los spec del deployment. Por ejemplo:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\nspec:\n revisionHistoryLimit: 3\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx\n...\n"})}),"\n",(0,a.jsx)(n.h3,{id:"hacer-un-rollback-a-una-versi\xf3n-anterior",children:"Hacer un rollback a una versi\xf3n anterior"}),"\n",(0,a.jsx)(n.p,{children:"Es posible hacer un rollback a una versi\xf3n anterior de un deployment, ya sea porque el \xfaltimo despliegue no funcione o la aplicaci\xf3n tenga errores inesperados.\nSe podr\xeda hacer con el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl rollout undo deployment nginx-deployment\n"})}),"\n",(0,a.jsx)(n.p,{children:"Este comando hace un rollback a la versi\xf3n anterior del deployment. Tambi\xe9n podr\xedamos especificarle\nuna versi\xf3n espec\xedfica:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl rollout undo deployment nginx-deployment --to-revision=1\n"})}),"\n",(0,a.jsx)(n.h2,{id:"pausar-y-reanudar-un-deployment",children:"Pausar y reanudar un deployment"}),"\n",(0,a.jsx)(n.p,{children:"Podemos pausar un deployment con el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl rollout pause deployment nginx-deployment\n"})}),"\n",(0,a.jsx)(n.p,{children:"Para reanudar un deployment usaremos el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl rollout resume deployment nginx-deployment\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},4552:(e,n,l)=>{l.d(n,{I:()=>s,M:()=>i});var a=l(11504);const o={},t=a.createContext(o);function i(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);