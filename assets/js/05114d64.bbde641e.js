"use strict";(self.webpackChunkpabpereza=self.webpackChunkpabpereza||[]).push([[6334],{83256:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>t,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=s(17624),o=s(4552);const r={},t=void 0,l={id:"notas/Kubernetes/pv_pvc",title:"pv_pvc",description:"En kubernetes existe la posibilidad de crear volumenes para persistir los datos de los pods. Estos se agrupan en dos objetos:",source:"@site/docs/notas/Kubernetes/pv_pvc.md",sourceDirName:"notas/Kubernetes",slug:"/notas/Kubernetes/pv_pvc",permalink:"/docs/notas/Kubernetes/pv_pvc",draft:!1,unlisted:!1,editUrl:"https://github.com/pabpereza/pabpereza/tree/main/docs/notas/Kubernetes/pv_pvc.md",tags:[],version:"current",frontMatter:{},sidebar:"notas",previous:{title:"pods",permalink:"/docs/notas/Kubernetes/pods"},next:{title:"recursos_personalizados",permalink:"/docs/notas/Kubernetes/recursos_personalizados"}},i={},c=[{value:"Persistent Volume (PV)",id:"persistent-volume-pv",level:2},{value:"Persistent Volume Claim",id:"persistent-volume-claim",level:2},{value:"Usar un PVC Persistent Volume Claim en un pod",id:"usar-un-pvc-persistent-volume-claim-en-un-pod",level:3},{value:"ResourceQuota para limitar el uso de un PVC",id:"resourcequota-para-limitar-el-uso-de-un-pvc",level:2}];function u(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.M)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"En kubernetes existe la posibilidad de crear volumenes para persistir los datos de los pods. Estos se agrupan en dos objetos:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:'PV: "Persistent Volume", es la declaraci\xf3n de un espacio del host que el cluster va a reservar para su uso.'}),"\n",(0,a.jsx)(n.li,{children:'PVC: "Persistent Volume Claim" es la petici\xf3n de reserva de espacio de un PV para un uso m\xe1s especifico, por ejemplo, para un \xfanico proyecto.'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Esta asiganaci\xf3n de espacio se realiza a dos niveles para reservar espacio para el cluster por un lado (PV) y luego se utilizan los objetos (PVC) para repartir ese espacio entre diferentes proyectos (namespaces) u objetos."}),"\n",(0,a.jsx)(n.h2,{id:"persistent-volume-pv",children:"Persistent Volume (PV)"}),"\n",(0,a.jsx)(n.p,{children:"Estos permiten m\xfaltiples configuraciones en funci\xf3n del tipo de cluster. En entornos de nube lo normal suele ser usar almacenamiento nativo del proveedor. En este ejemplo lo haremos utilizando un volumen NFS totalmente v\xe1lido para infraestructura no gestionada por un proveedor cloud."}),"\n",(0,a.jsx)(n.p,{children:"En esta entrada explico como trabajar con NFS (solo es necesaria la parte de servidor). [[nfs]]"}),"\n",(0,a.jsx)(n.p,{children:"Una vez que tenemos configurado el volumen NFS podemos configurarlo como volumen persistente en kubernetes con una configuraci\xf3n como la siguiente:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pvvol\nspec:\n  capacity:\n    storage: 40Gi\n  accessModes:\n    - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: /ruta/carpeta/nfs\n    server: <host>   #Puede ser un disco local o remoto\n    readOnly: false\n"})}),"\n",(0,a.jsx)(n.h2,{id:"persistent-volume-claim",children:"Persistent Volume Claim"}),"\n",(0,a.jsx)(n.p,{children:"Los claim sirve para hacer peticiones de espacio al cluster para que pueda ser consumido por un pod."}),"\n",(0,a.jsx)(n.p,{children:"Podemos consular los PVC existentes con el comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl get pvc\n"})}),"\n",(0,a.jsx)(n.p,{children:"Para crear un objeto PVC podemos usar un fichero de configuraci\xf3n como el siguiente:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc-test\nspec:\n  accessModes:\n  - ReadWriteMany\n  resources:\n     requests:\n       storage: 200Mi\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Aplicar\xedamos la configuraci\xf3n anterior con el comando ",(0,a.jsx)(n.code,{children:"create"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl create -f config_anterior.yaml\n"})}),"\n",(0,a.jsx)(n.p,{children:"Ya tendr\xedamos nuestro PVC. Este ahora podr\xeda ser consumido por un pod. Lo veremos en el siguiente punto."}),"\n",(0,a.jsx)(n.h3,{id:"usar-un-pvc-persistent-volume-claim-en-un-pod",children:"Usar un PVC Persistent Volume Claim en un pod"}),"\n",(0,a.jsx)(n.p,{children:"Podr\xedamos hacer que cualquier pod tuviera acceso a este PVC o volumen con una configuraci\xf3n como la siguiente:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"...\nspec:\n\tcontainers:\n\t- image: nginx\n\timagePullPolicy: Always\n\tname: nginx\n\tvolumeMounts:\n\t- name: nfs-vol\n\t\tmountPath: /opt\n\tports:\n\t- containerPort: 80\n\t\tprotocol: TCP\n\tresources: {}\n\tvolumes:  # Concretamente todo lo del grupo volumes \n\t- name: nfs-vol\n\t  persistentVolumeClaim:\n\t\tclaimName: pvc-test # Importante usar el mismo nombre que la declaraci\xf3n del PVC\n...\n"})}),"\n",(0,a.jsx)(n.p,{children:"Una vez terminada la configuraci\xf3n del pod, aplicamos el yaml con el comando create:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl create -f nfs-pod.yaml\n"})}),"\n",(0,a.jsx)(n.p,{children:"Si hacemos un describe del pod podemos ver el montaje de este volumen:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"...\nVolumes:\n  nfs-vol:\n    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)\n    ClaimName:  pvc-test\n    ReadOnly:   false\n...\n"})}),"\n",(0,a.jsx)(n.h2,{id:"resourcequota-para-limitar-el-uso-de-un-pvc",children:"ResourceQuota para limitar el uso de un PVC"}),"\n",(0,a.jsxs)(n.p,{children:["El objeto encargado de crear cuotas de recursos es ",(0,a.jsx)(n.code,{children:"ResourceQuota"}),". Este nos permite limitar el tama\xf1o y n\xfamero de PVC"]}),"\n",(0,a.jsx)(n.p,{children:"TODO"})]})}function d(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},4552:(e,n,s)=>{s.d(n,{I:()=>l,M:()=>t});var a=s(11504);const o={},r=a.createContext(o);function t(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);